{% extends "partials/base.html" %} {% load static %} {% block title %}Dashboard{% endblock title %} {% block extra_css %}
<!-- jsvectormap css -->
<link href="{% static 'libs/jsvectormap/dist/css/jsvectormap.min.css'%}" rel="stylesheet" type="text/css" />

<!--Swiper slider css-->
<link href="{% static 'libs/swiper/swiper-bundle.min.css'%}" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
{% endblock extra_css %} {% block content %}
<!-- ============================================================== -->
<!-- Start right Content here -->
<!-- ============================================================== -->
<div class="main-content">
  <div class="page-content">
    <div class="container-fluid">
      {% block pagetitle %} {% endblock pagetitle %}
      <div class="row">
        <div class="col">
          <div class="h-100">
            <div class="row mb-3 pb-1">
              <div class="col-12">
                <div class="d-flex align-items-lg-center flex-lg-row flex-column">
                  <div class="flex-grow-1">
                    <h4 class="fs-16 mb-1">Welcome Back, Smasco!</h4>
                    <p class="text-muted mb-0">Here's what's happening with your store today.</p>
                  </div>
                  <div class="mt-3 mt-lg-0">
                    <form id="timePeriodForm" action="{% url 'cdr3cx:dashboard' %}" method="GET">
                      <div class="row g-3 mb-0 align-items-center">
                        <div class="col-auto">
                          <div>
                            <button type="button" class="btn btn-soft-secondary material-shadow-none btn-sm" onclick="submitForm('today')">Today</button>
                            <button type="button" class="btn btn-soft-secondary material-shadow-none btn-sm" onclick="submitForm('7d')">7D</button>
                            <button type="button" class="btn btn-soft-secondary material-shadow-none btn-sm" onclick="submitForm('1m')">1M</button>
                            <button type="button" class="btn btn-soft-secondary material-shadow-none btn-sm" onclick="submitForm('6m')">6M</button>
                            <button type="button" class="btn btn-soft-primary material-shadow-none btn-sm" onclick="submitForm('1y')">1Y</button>
                            <input type="hidden" name="time_period" id="timePeriodInput" />
                          </div>
                        </div>
                        <!--end col-->
                        <div class="col-auto">
                          <div class="input-group">
                            <input type="text" class="form-control border-0 minimal-border dash-filter-picker shadow flatpickr-input" name="custom_date" data-provider="flatpickr" data-range-date="true" data-date-format="d M, Y" placeholder="Select custom date range" />
                            <div class="input-group-text bg-primary border-primary text-white">
                              <i class="ri-calendar-2-line"></i>
                            </div>
                          </div>
                        </div>
                        <!--end col-->
                        <div class="col-auto">
                          <button type="submit" class="btn btn-soft-info btn-icon waves-effect waves-light material-shadow-none layout-rightside-btn">
                            <i class="ri-pulse-line"></i>
                          </button>
                        </div>
                        <!--end col-->
                      </div>
                      <!--end row-->
                    </form>
                  </div>

                  <script>
                    function submitForm(timePeriod) {
                      document.getElementById("timePeriodInput").value = timePeriod;
                      document.getElementById("timePeriodForm").submit();
                    }
                  </script>
                </div>
                <!-- end card header -->
              </div>
              <!--end col-->
            </div>
            <!--end row-->

            <div class="row">
              <div class="col-xl-3 col-md-6">
                <!-- card -->
                <div class="card card-animate">
                  <div class="card-body">
                    <div class="d-flex align-items-center">
                      <div class="flex-grow-1 overflow-hidden">
                        <p class="text-uppercase fw-medium text-muted text-truncate mb-0">Total Calls</p>
                      </div>
                      <div class="flex-shrink-0">
                        <h5 class="text-success fs-14 mb-0"><i class="ri-arrow-right-up-line fs-13 align-middle"></i> +16.24 %</h5>
                      </div>
                    </div>
                    <div class="d-flex align-items-end justify-content-between mt-4">
                      <div>
                        <h4 class="fs-22 fw-semibold ff-secondary mb-4"><span class="counter-value" data-target="{{ total_calls }}">0</span></h4>
                        <a href="{% url 'cdr3cx:all_calls' %}" class="text-decoration-underline">View all Calls</a>
                      </div>
                      <div class="avatar-sm flex-shrink-0">
                        <span class="avatar-title bg-success-subtle rounded fs-3">
                          <i class="fas fa-phone-alt text-success"></i>
                        </span>
                      </div>
                    </div>
                  </div>
                  <!-- end card body -->
                </div>
                <!-- end card -->
              </div>
              <!-- end col -->

              <div class="col-xl-3 col-md-6">
                <!-- card -->
                <div class="card card-animate">
                  <div class="card-body">
                    <div class="d-flex align-items-center">
                      <div class="flex-grow-1 overflow-hidden">
                        <p class="text-uppercase fw-medium text-muted text-truncate mb-0">Local Calls</p>
                      </div>
                      <div class="flex-shrink-0">
                        <h5 class="text-danger fs-14 mb-0"><i class="ri-arrow-right-down-line fs-13 align-middle"></i> -3.57 %</h5>
                      </div>
                    </div>
                    <div class="d-flex align-items-end justify-content-between mt-4">
                      <div>
                        <h4 class="fs-22 fw-semibold ff-secondary mb-4"><span class="counter-value" data-target="{{total_local_calls }}">0</span></h4>
                        <a href="{% url 'cdr3cx:outgoing' %}" class="text-decoration-underline">See Details</a>
                      </div>
                      <div class="avatar-sm flex-shrink-0">
                        <span class="avatar-title bg-info-subtle rounded fs-3">
                          <i class="fas fa-phone-alt text-info"></i>
                        </span>
                      </div>
                    </div>
                  </div>
                  <!-- end card body -->
                </div>
                <!-- end card -->
              </div>
              <!-- end col -->

              <div class="col-xl-3 col-md-6">
                <!-- card -->
                <div class="card card-animate">
                  <div class="card-body">
                    <div class="d-flex align-items-center">
                      <div class="flex-grow-1 overflow-hidden">
                        <p class="text-uppercase fw-medium text-muted text-truncate mb-0">Incoming Calls</p>
                      </div>
                      <div class="flex-shrink-0">
                        <h5 class="text-success fs-14 mb-0"><i class="ri-arrow-right-up-line fs-13 align-middle"></i> +29.08 %</h5>
                      </div>
                    </div>
                    <div class="d-flex align-items-end justify-content-between mt-4">
                      <div>
                        <h4 class="fs-22 fw-semibold ff-secondary mb-4"><span class="counter-value" data-target="{{ total_national_mobile_calls }}">0</span></h4>
                        <a href="{% url 'cdr3cx:incoming' %}" class="text-decoration-underline">See details</a>
                      </div>
                      <div class="avatar-sm flex-shrink-0">
                        <span class="avatar-title bg-warning-subtle rounded fs-3">
                          <i class="bx bx-mobile-alt text-info"></i>
                        </span>
                      </div>
                    </div>
                  </div>
                  <!-- end card body -->
                </div>
                <!-- end card -->
              </div>
              <!-- end col -->

              <div class="col-xl-3 col-md-6">
                <!-- card -->
                <div class="card card-animate">
                  <div class="card-body">
                    <div class="d-flex align-items-center">
                      <div class="flex-grow-1 overflow-hidden">
                        <p class="text-uppercase fw-medium text-muted text-truncate mb-0">International Calls</p>
                      </div>
                      <div class="flex-shrink-0">
                        <h5 class="text-muted fs-14 mb-0">+0.00 %</h5>
                      </div>
                    </div>
                    <div class="d-flex align-items-end justify-content-between mt-4">
                      <div>
                        <h4 class="fs-22 fw-semibold ff-secondary mb-4"><span class="counter-value" data-target="{{ total_international_calls }}">0</span></h4>
                        <a href="{% url 'cdr3cx:outgoing_international' %}" class="text-decoration-underline">View International Calls</a>
                      </div>
                      <div class="avatar-sm flex-shrink-0">
                        <span class="avatar-title bg-primary-subtle rounded fs-3">
                          <i class="bx bx-globe text-primary"></i>
                        </span>
                      </div>
                    </div>
                  </div>
                  <!-- end card body -->
                </div>
                <!-- end card -->
              </div>
              <!-- end col -->
            </div>
            <!-- end row-->

            <div class="row">
              <div class="col-xl-8">
                <div class="card">
                  <div class="card-header border-0 align-items-center d-flex">
                    <h4 class="card-title mb-0 flex-grow-1">Revenue</h4>
                    <div>
                      <button type="button" class="btn btn-soft-secondary material-shadow-none btn-sm">ALL</button>
                      <button type="button" class="btn btn-soft-secondary material-shadow-none btn-sm">1M</button>
                      <button type="button" class="btn btn-soft-secondary material-shadow-none btn-sm">6M</button>
                      <button type="button" class="btn btn-soft-primary material-shadow-none btn-sm">1Y</button>
                    </div>
                  </div>
                  <!-- end card header -->

                  <div class="card-header p-0 border-0 bg-light-subtle">
                    <div class="row g-0 text-center">
                      <div class="col-6 col-sm-3">
                        <div class="p-3 border border-dashed border-start-0">
                          <h5 class="mb-1"><span class="counter-value" data-target="7585">0</span></h5>
                          <p class="text-muted mb-0">Orders</p>
                        </div>
                      </div>
                      <!--end col-->
                      <div class="col-6 col-sm-3">
                        <div class="p-3 border border-dashed border-start-0">
                          <h5 class="mb-1">$<span class="counter-value" data-target="22.89">0</span>k</h5>
                          <p class="text-muted mb-0">Earnings</p>
                        </div>
                      </div>
                      <!--end col-->
                      <div class="col-6 col-sm-3">
                        <div class="p-3 border border-dashed border-start-0">
                          <h5 class="mb-1"><span class="counter-value" data-target="367">0</span></h5>
                          <p class="text-muted mb-0">Refunds</p>
                        </div>
                      </div>
                      <!--end col-->
                      <div class="col-6 col-sm-3">
                        <div class="p-3 border border-dashed border-start-0 border-end-0">
                          <h5 class="mb-1 text-success"><span class="counter-value" data-target="18.92">0</span>%</h5>
                          <p class="text-muted mb-0">Conversation Ratio</p>
                        </div>
                      </div>
                      <!--end col-->
                    </div>
                  </div>
                  <!-- end card header -->

                  <div class="card-body p-0 pb-2">
                    <div class="w-100">
                      <div id="customer_impression_charts" data-colors='["--vz-primary", "--vz-success", "--vz-danger"]' data-colors-minimal='["--vz-light", "--vz-primary", "--vz-info"]' data-colors-saas='["--vz-success", "--vz-info", "--vz-danger"]' data-colors-modern='["--vz-warning", "--vz-primary", "--vz-success"]' data-colors-interactive='["--vz-info", "--vz-primary", "--vz-danger"]' data-colors-creative='["--vz-warning", "--vz-primary", "--vz-danger"]' data-colors-corporate='["--vz-light", "--vz-primary", "--vz-secondary"]' data-colors-galaxy='["--vz-secondary", "--vz-primary", "--vz-primary-rgb, 0.50"]' data-colors-classic='["--vz-light", "--vz-primary", "--vz-secondary"]' data-colors-vintage='["--vz-success", "--vz-primary", "--vz-secondary"]' class="apex-charts" dir="ltr"></div>
                    </div>
                  </div>
                  <!-- end card body -->
                </div>
                <!-- end card -->
              </div>
              <!-- end col -->
              <div class="col-xl-4">
                <div class="card card-height-100">
                  <div class="card-header align-items-center d-flex">
                    <h4 class="card-title mb-0 flex-grow-1">Calls Ratio</h4>
                    <div class="flex-shrink-0">
                      <div class="dropdown card-header-dropdown">
                        <a class="text-reset dropdown-btn" href="#" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <span class="text-muted">Report<i class="mdi mdi-chevron-down ms-1"></i></span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end">
                          <a class="dropdown-item" href="#">Download Report</a>
                          <a class="dropdown-item" href="#">Export</a>
                          <a class="dropdown-item" href="#">Import</a>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- end card header -->

                  <div class="card-body">
                    <div class="card-body">
                      <div id="calls-ratio-chart" class="apex-charts" dir="ltr"></div>
                      <div class="text-center mt-2">
                        <h4 id="selected-ratio-title">Total Calls</h4>
                        <p class="mb-0">
                          <span id="selected-ratio-value">{{ total_calls }}</span>
                          (<span id="selected-ratio-percentage">100%</span>)
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- .card-->
              </div>
              <!-- .col-->
            </div>

            <!-- here will be teh row 1 -->
          </div>
          <!-- end .h-100-->
        </div>
        <!-- end col -->

        <div class="col-auto layout-rightside-col">
          <div class="overlay"></div>
          <div class="layout-rightside">
            <div class="card h-100 rounded-0">
              <div class="card-body p-0">
                <div class="p-3">
                  <h6 class="text-muted mb-0 text-uppercase fw-semibold">Recent Call Activity</h6>
                </div>
                <div data-simplebar style="max-height: 410px" class="p-3 pt-0">
                  <div class="acitivity-timeline acitivity-main">
                    <div class="acitivity-item d-flex">
                      <div class="flex-shrink-0 avatar-xs acitivity-avatar">
                        <div class="avatar-title bg-success-subtle text-success rounded-circle">
                          <i class="ri-shopping-cart-2-line"></i>
                        </div>
                      </div>
                      <div class="flex-grow-1 ms-3">
                        <h6 class="mb-1 lh-base">Caller Number</h6>
                        <small class="mb-0 text-muted">02:14 PM Today</small>
                      </div>
                    </div>
                    <div class="acitivity-item py-3 d-flex">
                      <div class="flex-shrink-0 avatar-xs acitivity-avatar">
                        <div class="avatar-title bg-danger-subtle text-danger rounded-circle">
                          <i class="ri-stack-fill"></i>
                        </div>
                      </div>
                      <div class="flex-grow-1 ms-3">
                        <h6 class="mb-1 lh-base">Called <span class="fw-semibold">style Number</span></h6>

                        <p class="mb-0 text-muted"><small>9:47 PM Yesterday</small></p>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="p-3 mt-2">
                  <h6 class="text-muted mb-3 text-uppercase fw-semibold">Top 10 Countries</h6>

                  <ol class="ps-3 text-muted">
                    <li class="py-1">
                      <a href="#" class="text-muted">Saudi Arabia<span class="float-end">(10,294)</span></a>
                    </li>
                    <li class="py-1">
                      <a href="#" class="text-muted">Egypt <span class="float-end">(6,256)</span></a>
                    </li>
                  </ol>
                  <div class="mt-3 text-center">
                    <a href="javascript:void(0);" class="text-muted text-decoration-underline">View all Countries</a>
                  </div>
                </div>
              </div>
            </div>
            <!-- end card-->
          </div>
          <!-- end .rightbar-->
        </div>
        <!-- end col -->
      </div>
    </div>
    <!-- container-fluid -->
  </div>
  <!-- End Page-content -->
  {% block footer %} {% include "partials/footer.html" %} {% endblock footer %}
</div>
<!-- end main content-->
{% endblock content %} {% block extra_js %}
<!-- apexcharts -->
<script src="{% static 'libs/apexcharts/dist/apexcharts.min.js'%}"></script>

<!-- Vector map-->
<script src="{% static 'libs/jsvectormap/dist/js/jsvectormap.min.js'%}"></script>
<script src="{% static 'libs/jsvectormap/dist/maps/world-merc.js'%}"></script>

<!--Swiper slider js-->
<script src="{% static 'libs/swiper/swiper-bundle.min.js'%}"></script>

<!-- Dashboard init -->
<script src="{% static 'js/pages/dashboard-ecommerce.init.js'%}"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
      var options = {
          series: [
              {{ total_external_calls }},
              {{ total_international_calls }},
              {{ total_national_mobile_calls }},
              {{ total_national_calls }}
          ],
          chart: {
              height: 350,
              type: 'donut',
              events: {
                  dataPointSelection: function(event, chartContext, config) {
                      var selectedLabel = config.w.config.labels[config.dataPointIndex];
                      var selectedValue = config.w.config.series[config.dataPointIndex];
                      var total = config.w.config.series.reduce((a, b) => a + b, 0);
                      var percentage = ((selectedValue / total) * 100).toFixed(1);

                      document.querySelector("#selected-ratio-title").textContent = selectedLabel;
                      document.querySelector("#selected-ratio-value").textContent = selectedValue;
                      document.querySelector("#selected-ratio-percentage").textContent = percentage + '%';
                  }
              }
          },
          labels: ['External', 'International', 'National Mobile', 'National'],
          colors: ["#556ee6", "#34c38f", "#f46a6a", "#f1b44c"],
          plotOptions: {
              pie: {
                  donut: {
                      size: '70%',
                      background: 'transparent',
                      labels: {
                          show: true,
                          name: {
                              show: true,
                              fontSize: '22px',
                              fontFamily: 'Helvetica, Arial, sans-serif',
                              fontWeight: 600,
                              color: undefined,
                              offsetY: -10
                          },
                          value: {
                              show: true,
                              fontSize: '18px',
                              fontFamily: 'Helvetica, Arial, sans-serif',
                              fontWeight: 400,
                              color: undefined,
                              offsetY: 10,
                              formatter: function (val) {
                                  return val
                              }
                          },
                          total: {
                              show: true,
                              showAlways: true,
                              label: 'Total Calls',
                              fontSize: '22px',
                              fontFamily: 'Helvetica, Arial, sans-serif',
                              fontWeight: 600,
                              color: '#373d3f'
                          }
                      }
                  }
              }
          },
          legend: {
              show: true,
              position: 'bottom',
              horizontalAlign: 'center',
              floating: false,
              fontSize: '14px',
              fontFamily: 'Helvetica, Arial, sans-serif',
              formatter: function(seriesName, opts) {
                  return [seriesName, " - ", opts.w.globals.series[opts.seriesIndex]]
              }
          },
          dataLabels: {
              enabled: true,
              formatter: function (val, opts) {
                  return Math.round(val) + '%'
              },
              style: {
                  fontSize: '14px',
                  fontWeight: 'bold',
                  colors: ['#fff']
              },
              background: {
                  enabled: true,
                  foreColor: '#000',
                  padding: 4,
                  borderRadius: 2,
                  borderWidth: 1,
                  borderColor: '#fff',
                  opacity: 0.5,
              },
              dropShadow: {
                  enabled: false
              }
          },
          responsive: [{
              breakpoint: 480,
              options: {
                  chart: {
                      height: 300
                  }
              }
          }],
          noData: {
              text: 'No calls data available'
          }
      };

      // Filter out zero values
      options.series = options.series.filter((value, index) => {
          if (value === 0) {
              options.labels.splice(index, 1);
              options.colors.splice(index, 1);
              return false;
          }
          return true;
      });

      var chart = new ApexCharts(document.querySelector("#calls-ratio-chart"), options);
      chart.render();
  });
</script>

{% endblock extra_js %}
